import{a as Y}from"./chunk-ADVWGGQ5.js";import{a as W,c as J,d as K,f as X}from"./chunk-QL7PU4CC.js";import{a as b}from"./chunk-KCYCIDWO.js";import{b as $,d as A,e as V,f as D,g as H,h as U,i as q,j as F,k as B,l as R,m as j,o as N}from"./chunk-6WXIQJKU.js";import{a as Q}from"./chunk-M7OYHYAL.js";import{D as h,G as u,H as a,I as i,J as p,N as v,O as f,P as m,X as r,Y as M,Z as x,db as G,ga as S,ia as T,ka as z,la as L,n as _,na as O,o as E,w as l,x as P,z as y}from"./chunk-I3YUSPIV.js";import"./chunk-YGN2HXTN.js";import"./chunk-RZ5T5SE5.js";import"./chunk-O33TUF6J.js";import"./chunk-67S4WPSR.js";import"./chunk-F7XBNY6P.js";import"./chunk-5S5ELBDR.js";import"./chunk-LRNV46AZ.js";import"./chunk-6FMIVMID.js";import"./chunk-4U6PRYVA.js";import"./chunk-JJQUOQDV.js";import"./chunk-JWIEPCRG.js";import"./chunk-QPVVTFFW.js";import"./chunk-J6ICYO4L.js";import"./chunk-LF5XB4YN.js";import{i as d}from"./chunk-OYAVQN5W.js";function ee(t){t.CapacitorUtils.Synapse=new Proxy({},{get(c,s){return new Proxy({},{get(e,o){return(n,g,I)=>{let k=t.Capacitor.Plugins[s];if(k===void 0){I(new Error(`Capacitor plugin ${s} not found`));return}if(typeof k[o]!="function"){I(new Error(`Method ${o} not found in Capacitor plugin ${s}`));return}d(this,null,function*(){try{let C=yield k[o](n);g(C)}catch(C){I(C)}})}}})}})}function te(t){t.CapacitorUtils.Synapse=new Proxy({},{get(c,s){return t.cordova.plugins[s]}})}function Z(t=!1){window.CapacitorUtils=window.CapacitorUtils||{},window.Capacitor!==void 0&&!t?ee(window):window.cordova!==void 0&&te(window)}var w=Y("Geolocation",{web:()=>import("./chunk-LBUJWN4V.js").then(t=>new t.GeolocationWeb)});Z();function oe(t,c){if(t&1&&(a(0,"div",12)(1,"ion-card",13)(2,"ion-card-content")(3,"p"),r(4),i()()()()),t&2){let s=m();l(4),M(s.errorMessage)}}function ie(t,c){if(t&1){let s=v();a(0,"ion-card",14)(1,"ion-card-header")(2,"ion-card-title"),r(3,"Permiss\xE3o Necess\xE1ria"),i()(),a(4,"ion-card-content")(5,"p"),r(6,"Para usar a funcionalidade de localiza\xE7\xE3o, voc\xEA precisa conceder permiss\xE3o de acesso \xE0 sua localiza\xE7\xE3o."),i(),a(7,"ion-button",15),f("click",function(){_(s);let o=m();return E(o.checkLocationPermissions())}),r(8," Conceder Permiss\xE3o "),i()()()}}function ne(t,c){if(t&1&&(a(0,"p")(1,"strong"),r(2,"Endere\xE7o:"),i(),r(3),i()),t&2){let s=m(2);l(3),x(" ",s.address,"")}}function ae(t,c){t&1&&(a(0,"p",17),p(1,"ion-icon",18),r(2," Rastreamento ativo "),i())}function re(t,c){if(t&1&&(a(0,"div")(1,"p")(2,"strong"),r(3,"Latitude:"),i(),r(4),i(),a(5,"p")(6,"strong"),r(7,"Longitude:"),i(),r(8),i(),h(9,ne,4,1,"p",5)(10,ae,3,0,"p",16),i()),t&2){let s=m();l(4),x(" ",s.latitude,""),l(4),x(" ",s.longitude,""),l(),u("ngIf",s.address),l(),u("ngIf",s.isTracking)}}function se(t,c){t&1&&(a(0,"div")(1,"p"),r(2,"Clique no bot\xE3o abaixo para obter sua localiza\xE7\xE3o atual."),i()())}function ce(t,c){if(t&1){let s=v();a(0,"ion-button",19),f("click",function(){_(s);let o=m();return E(o.startTracking())}),p(1,"ion-icon",20),r(2," Iniciar Rastreamento "),i()}}function le(t,c){if(t&1){let s=v();a(0,"ion-button",21),f("click",function(){_(s);let o=m();return E(o.stopTracking())}),p(1,"ion-icon",22),r(2," Parar Rastreamento "),i()}}var ye=(()=>{let c=class c{constructor(e,o){this.http=e,this.storage=o,this.address="",this.errorMessage="",this.isTracking=!1,this.userId="",this.patientId="",this.permissionGranted=!1,W({locateOutline:J,navigateOutline:K,stopOutline:X})}ngOnInit(){return d(this,null,function*(){try{yield this.storage.create(),console.log("Storage inicializado com sucesso");let e=yield this.storage.get("user");console.log("Dados do usu\xE1rio:",e),e?(this.userId=e.id,this.getPatientId()):(this.errorMessage="Usu\xE1rio n\xE3o encontrado. Fa\xE7a login novamente.",console.log("Usu\xE1rio n\xE3o encontrado no storage")),yield this.checkLocationPermissions()}catch(e){console.error("Erro na inicializa\xE7\xE3o:",e),this.errorMessage="Erro ao inicializar a p\xE1gina. Tente novamente."}})}checkLocationPermissions(){return d(this,null,function*(){try{let e=yield w.checkPermissions();if(console.log("Status da permiss\xE3o de localiza\xE7\xE3o:",e.location),e.location==="granted")this.permissionGranted=!0;else{let o=yield w.requestPermissions();console.log("Status da solicita\xE7\xE3o de permiss\xE3o:",o.location),this.permissionGranted=o.location==="granted"}this.permissionGranted||(this.errorMessage="Permiss\xE3o de localiza\xE7\xE3o n\xE3o concedida. A funcionalidade de localiza\xE7\xE3o n\xE3o funcionar\xE1.")}catch(e){console.error("Erro ao verificar permiss\xF5es:",e),this.errorMessage="Erro ao verificar permiss\xF5es de localiza\xE7\xE3o."}})}getPatientId(){return d(this,null,function*(){try{let e=yield this.storage.get("token");if(console.log("Token recuperado:",e?"Sim":"N\xE3o"),!e){this.errorMessage="Voc\xEA precisa estar logado para usar esta funcionalidade";return}let o=new z({Authorization:`Bearer ${e}`});console.log("Fazendo requisi\xE7\xE3o para:",`${b.apiUrl}/patient/user/${this.userId}`),this.http.get(`${b.apiUrl}/patient/user/${this.userId}`,{headers:o}).subscribe(n=>{console.log("Resposta da API (paciente):",n),this.patientId=n.id},n=>{console.error("Erro ao obter informa\xE7\xF5es do paciente:",n),this.errorMessage="Erro ao obter informa\xE7\xF5es do paciente: "+(n.message||"Erro desconhecido")})}catch(e){console.error("Erro ao obter ID do paciente:",e),this.errorMessage="Erro ao obter ID do paciente."}})}getCurrentLocation(){return d(this,null,function*(){try{if(!this.permissionGranted&&(yield this.checkLocationPermissions(),!this.permissionGranted))return;console.log("Obtendo localiza\xE7\xE3o atual...");let e=yield w.getCurrentPosition({enableHighAccuracy:!0,timeout:1e4});console.log("Posi\xE7\xE3o obtida:",e),this.latitude=e.coords.latitude,this.longitude=e.coords.longitude,this.errorMessage="",yield this.getAddressFromCoordinates()}catch(e){console.error("Erro ao obter localiza\xE7\xE3o:",e),this.errorMessage="Erro ao obter localiza\xE7\xE3o: "+(e.message||"Erro desconhecido")}})}getAddressFromCoordinates(){return d(this,null,function*(){try{if(!this.latitude||!this.longitude){console.error("Latitude ou longitude n\xE3o definidas");return}console.log("Obtendo endere\xE7o para coordenadas:",this.latitude,this.longitude);let e=yield fetch(`https://nominatim.openstreetmap.org/reverse?format=json&lat=${this.latitude}&lon=${this.longitude}`);if(!e.ok)throw new Error(`Erro HTTP: ${e.status}`);let o=yield e.json();console.log("Dados do endere\xE7o:",o),this.address=o.display_name}catch(e){console.error("Erro ao obter endere\xE7o:",e),this.address="Endere\xE7o n\xE3o dispon\xEDvel"}})}startTracking(){return d(this,null,function*(){if(!(!this.permissionGranted&&(yield this.checkLocationPermissions(),!this.permissionGranted))){if(!this.patientId){this.errorMessage="ID do paciente n\xE3o encontrado";return}this.isTracking=!0,yield this.getCurrentLocation(),this.trackingInterval=setInterval(()=>d(this,null,function*(){yield this.getCurrentLocation(),this.latitude&&this.longitude&&(yield this.sendLocationToServer())}),6e4),console.log("Rastreamento iniciado")}})}stopTracking(){this.isTracking=!1,clearInterval(this.trackingInterval),console.log("Rastreamento parado")}sendLocationToServer(){return d(this,null,function*(){try{if(!this.latitude||!this.longitude){console.error("Tentativa de enviar localiza\xE7\xE3o sem coordenadas v\xE1lidas");return}let e=yield this.storage.get("token");if(!e){this.errorMessage="Voc\xEA precisa estar logado para usar esta funcionalidade";return}let o=new z({Authorization:`Bearer ${e}`}),n={latitude:this.latitude,longitude:this.longitude,address:this.address};console.log("Enviando dados de localiza\xE7\xE3o:",n),this.http.post(`${b.apiUrl}/location/${this.patientId}`,n,{headers:o}).subscribe(g=>{console.log("Localiza\xE7\xE3o enviada com sucesso",g)},g=>{console.error("Erro ao enviar localiza\xE7\xE3o:",g),this.errorMessage="Erro ao enviar localiza\xE7\xE3o: "+(g.message||"Erro desconhecido")})}catch(e){console.error("Erro ao enviar localiza\xE7\xE3o para o servidor:",e),this.errorMessage="Erro ao enviar localiza\xE7\xE3o para o servidor."}})}};c.\u0275fac=function(o){return new(o||c)(P(L),P(Q))},c.\u0275cmp=y({type:c,selectors:[["app-localizacao"]],decls:33,vars:7,consts:[["slot","start"],["defaultHref","/"],[1,"ion-padding"],["class","error-message ion-margin-bottom",4,"ngIf"],["color","warning","class","ion-margin-bottom",4,"ngIf"],[4,"ngIf"],[1,"ion-text-center","ion-margin-top"],["expand","block",3,"click","disabled"],["name","locate-outline","slot","start"],["expand","block","color","success",3,"click",4,"ngIf"],["expand","block","color","danger",3,"click",4,"ngIf"],[1,"info-card","ion-margin-top"],[1,"error-message","ion-margin-bottom"],["color","danger"],["color","warning",1,"ion-margin-bottom"],["expand","block",1,"ion-margin-top",3,"click"],["class","tracking-active",4,"ngIf"],[1,"tracking-active"],["name","navigate-outline"],["expand","block","color","success",3,"click"],["name","navigate-outline","slot","start"],["expand","block","color","danger",3,"click"],["name","stop-outline","slot","start"]],template:function(o,n){o&1&&(a(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0),p(3,"ion-back-button",1),i(),a(4,"ion-title"),r(5,"Localiza\xE7\xE3o"),i()()(),a(6,"ion-content",2),h(7,oe,5,1,"div",3)(8,ie,9,0,"ion-card",4),a(9,"ion-card")(10,"ion-card-header")(11,"ion-card-title"),r(12,"Sua Localiza\xE7\xE3o Atual"),i()(),a(13,"ion-card-content"),h(14,re,11,4,"div",5)(15,se,3,0,"div",5),i()(),a(16,"div",6)(17,"ion-button",7),f("click",function(){return n.getCurrentLocation()}),p(18,"ion-icon",8),r(19," Obter Localiza\xE7\xE3o Atual "),i(),h(20,ce,3,0,"ion-button",9)(21,le,3,0,"ion-button",10),i(),a(22,"ion-card",11)(23,"ion-card-header")(24,"ion-card-title"),r(25,"Informa\xE7\xF5es"),i()(),a(26,"ion-card-content")(27,"p"),r(28,"O rastreamento de localiza\xE7\xE3o permite que seus cuidadores saibam onde voc\xEA est\xE1 em caso de emerg\xEAncia."),i(),a(29,"p"),r(30,"Quando o rastreamento est\xE1 ativo, sua localiza\xE7\xE3o \xE9 atualizada a cada minuto."),i(),a(31,"p"),r(32,"Voc\xEA pode interromper o rastreamento a qualquer momento."),i()()()()),o&2&&(l(7),u("ngIf",n.errorMessage),l(),u("ngIf",!n.permissionGranted),l(6),u("ngIf",n.latitude&&n.longitude),l(),u("ngIf",!n.latitude&&!n.longitude&&!n.errorMessage&&n.permissionGranted),l(2),u("disabled",n.isTracking||!n.permissionGranted),l(3),u("ngIf",!n.isTracking&&n.permissionGranted),l(),u("ngIf",n.isTracking))},dependencies:[F,B,R,j,T,S,G,O,D,U,q,H,A,N,V,$],styles:["ion-card[_ngcontent-%COMP%]{margin-bottom:20px;border-radius:12px;box-shadow:0 4px 12px #0000001a}.error-message[_ngcontent-%COMP%]{color:var(--ion-color-danger);margin:10px 0;font-weight:700}.info-card[_ngcontent-%COMP%]{margin-top:20px;background-color:#f8f9fa}ion-button[_ngcontent-%COMP%]{margin-bottom:12px;--border-radius: 8px}ion-card-title[_ngcontent-%COMP%]{font-size:1.2rem;font-weight:600}p[_ngcontent-%COMP%]{margin:8px 0;line-height:1.5}strong[_ngcontent-%COMP%]{font-weight:600}.ion-text-center[_ngcontent-%COMP%]{margin:20px 0}.tracking-active[_ngcontent-%COMP%]{color:var(--ion-color-success);font-weight:700;display:flex;align-items:center;margin-top:12px}.tracking-active[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{margin-right:8px;font-size:18px}ion-card[color=danger][_ngcontent-%COMP%]{--ion-card-background: rgba(var(--ion-color-danger-rgb), .15);--ion-card-color: var(--ion-color-danger-shade)}ion-card[color=warning][_ngcontent-%COMP%]{--ion-card-background: rgba(var(--ion-color-warning-rgb), .15);--ion-card-color: var(--ion-color-warning-shade)}"]});let t=c;return t})();export{ye as LocalizacaoPage};

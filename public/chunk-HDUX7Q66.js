import{a as me}from"./chunk-BTH7EP3S.js";import"./chunk-KCYCIDWO.js";import{A as ie,B as te,C as ne,E as oe,F as ae,G as re,I as se,J as le,K as ge,b as A,c as G,f as U,g as J,n as K,p as Q,r as X,s as Y,t as Z,y as $,z as ee}from"./chunk-BKSPUT4V.js";import"./chunk-PIU5UDQ6.js";import"./chunk-D7YN4OJI.js";import"./chunk-5GUBFEH3.js";import"./chunk-4PGTP63H.js";import"./chunk-B3GVBKL3.js";import"./chunk-HC6MZPB3.js";import"./chunk-DYTQHTWS.js";import"./chunk-FERD25SW.js";import"./chunk-YYX6ZCUM.js";import"./chunk-EQKTRDAQ.js";import"./chunk-MM5QLNJM.js";import"./chunk-72KDLSWN.js";import"./chunk-5OMUW5VI.js";import"./chunk-OBXDPQ3V.js";import"./chunk-KRKXOG46.js";import"./chunk-MCRJI3T3.js";import"./chunk-5F3K422G.js";import"./chunk-Y2IKLLDI.js";import{a as z}from"./chunk-M7OYHYAL.js";import{$ as w,$a as j,D as C,F as f,G as d,H as t,I as n,J as v,N as P,O as y,P as c,Ua as V,Va as B,W as S,Wa as W,X as s,Xa as F,Ya as R,_ as b,aa as x,bb as D,cb as q,db as H,ga as M,ia as T,n as u,na as E,o as p,ra as k,sa as O,w as r,wa as N,x as h,z as I}from"./chunk-I3YUSPIV.js";import"./chunk-RZ5T5SE5.js";import"./chunk-O33TUF6J.js";import"./chunk-67S4WPSR.js";import"./chunk-F7XBNY6P.js";import"./chunk-5S5ELBDR.js";import"./chunk-LRNV46AZ.js";import"./chunk-6FMIVMID.js";import"./chunk-JJQUOQDV.js";import"./chunk-JWIEPCRG.js";import"./chunk-LF5XB4YN.js";import{i as m}from"./chunk-OYAVQN5W.js";function de(o,l){o&1&&v(0,"ion-spinner",21)}function ce(o,l){o&1&&(t(0,"span"),s(1,"Entrar"),n())}function ue(o,l){if(o&1){let g=P();t(0,"form",9,0),y("ngSubmit",function(){u(g);let i=c();return p(i.onSubmit())}),t(2,"h1",10),s(3,"Bem-vindo!"),n(),t(4,"p",10),s(5,"Cuidador, acesse sua conta"),n(),t(6,"ion-item",11)(7,"ion-label",12),s(8,"E-mail"),n(),t(9,"ion-input",13),x("ngModelChange",function(i){u(g);let a=c();return w(a.email,i)||(a.email=i),p(i)}),n()(),t(10,"ion-item",11)(11,"ion-label",12),s(12,"Senha"),n(),t(13,"ion-input",14),x("ngModelChange",function(i){u(g);let a=c();return w(a.password,i)||(a.password=i),p(i)}),n()(),t(14,"div",11)(15,"ion-button",15),C(16,de,1,0,"ion-spinner",16)(17,ce,2,0,"span",17),n()(),t(18,"div",18)(19,"ion-text",19),s(20," N\xE3o tem uma conta? "),t(21,"a",20),s(22,"Cadastre-se"),n()()()()}if(o&2){let g=S(1),e=c();r(9),b("ngModel",e.email),f("aria-label","Digite seu email"),r(4),b("ngModel",e.password),f("aria-label","Digite sua senha"),r(2),d("disabled",!g.form.valid||e.isLoading),r(),d("ngIf",e.isLoading),r(),d("ngIf",!e.isLoading),r(4),f("aria-label","Ir para p\xE1gina de cadastro")}}function pe(o,l){o&1&&v(0,"ion-spinner",21)}function he(o,l){o&1&&(t(0,"span"),s(1,"Entrar"),n())}function fe(o,l){if(o&1){let g=P();t(0,"form",9,1),y("ngSubmit",function(){u(g);let i=c();return p(i.onPinSubmit())}),t(2,"h1",10),s(3,"Bem-vindo!"),n(),t(4,"p",10),s(5,"Idoso, digite seu PIN para acessar"),n(),t(6,"ion-item",11)(7,"ion-label",12),s(8,"PIN"),n(),t(9,"ion-input",22),x("ngModelChange",function(i){u(g);let a=c();return w(a.pin,i)||(a.pin=i),p(i)}),n()(),t(10,"div",11)(11,"ion-button",15),C(12,pe,1,0,"ion-spinner",16)(13,he,2,0,"span",17),n()()()}if(o&2){let g=S(1),e=c();r(9),b("ngModel",e.pin),f("aria-label","Digite seu PIN de acesso"),r(2),d("disabled",!g.form.valid||e.isLoading),r(),d("ngIf",e.isLoading),r(),d("ngIf",!e.isLoading)}}var Te=(()=>{let l=class l{constructor(e,i,a,L,_){this.router=e,this.storage=i,this.toastController=a,this.loadingController=L,this.authService=_,this.email="",this.password="",this.pin="",this.loginType="caregiver",this.isLoading=!1}ngOnInit(){return m(this,null,function*(){yield this.storage.create(),(yield this.storage.get("token"))&&this.authService.getProfile().subscribe(i=>{console.log("Usu\xE1rio j\xE1 autenticado:",i),this.navigateBasedOnRole(i.role)},i=>{console.error("Token inv\xE1lido ou expirado:",i),this.storage.remove("token"),this.storage.remove("user")})})}onLoginTypeChange(){console.log("Tipo de login alterado para:",this.loginType),this.email="",this.password="",this.pin=""}onSubmit(){return m(this,null,function*(){if(!this.email||!this.password){this.showToast("Por favor, preencha todos os campos");return}yield this.presentLoading("Entrando...");try{this.authService.login(this.email,this.password).subscribe(e=>m(this,null,function*(){if(console.log("Login bem-sucedido:",e),e.statusCode===401){this.dismissLoading(),this.showToast("Credenciais inv\xE1lidas");return}if(e.statusCode===403&&e.needsVerification){this.dismissLoading(),this.showToast("Email n\xE3o verificado. Redirecionando para verifica\xE7\xE3o..."),setTimeout(()=>{this.router.navigate(["/verify-email"],{queryParams:{email:this.email}})},1500);return}yield this.storage.set("token",e.access_token),yield this.storage.set("user",e.user),this.dismissLoading(),this.showToast("Login realizado com sucesso!"),setTimeout(()=>{e.user&&e.user.role?this.navigateBasedOnRole(e.user.role):(console.error("Papel do usu\xE1rio n\xE3o encontrado na resposta:",e),this.router.navigate(["/home-cuidador"]))},1e3)}),e=>{var i;console.error("Erro no login:",e),this.dismissLoading(),this.showToast("Erro no login: "+(((i=e.error)==null?void 0:i.message)||"Credenciais inv\xE1lidas"))})}catch(e){console.error("Erro ao processar login:",e),this.dismissLoading(),this.showToast("Erro ao processar login")}})}onPinSubmit(){return m(this,null,function*(){if(!this.pin){this.showToast("Por favor, digite seu PIN");return}yield this.presentLoading("Entrando...");try{this.authService.login(this.pin,"PIN_LOGIN").subscribe(e=>m(this,null,function*(){if(console.log("Login com PIN bem-sucedido:",e),e.statusCode===401){this.dismissLoading(),this.showToast("PIN inv\xE1lido");return}yield this.storage.set("token",e.access_token),yield this.storage.set("user",e.user),this.dismissLoading(),this.showToast("Login realizado com sucesso!"),setTimeout(()=>{this.router.navigate(["/home-cuidador"])},1e3)}),e=>{var i;console.error("Erro no login com PIN:",e),this.dismissLoading(),this.showToast("Erro no login: "+(((i=e.error)==null?void 0:i.message)||"PIN inv\xE1lido"))})}catch(e){console.error("Erro ao processar login com PIN:",e),this.dismissLoading(),this.showToast("Erro ao processar login")}})}navigateBasedOnRole(e){switch(console.log("Navegando com base no papel:",e),e){case"caregiver":this.router.navigate(["/home-cuidador"]);break;case"patient":this.router.navigate(["/home-cuidador"]);break;case"admin":this.router.navigate(["/admin"]);break;default:this.router.navigate(["/home-cuidador"])}}showToast(e){return m(this,null,function*(){yield(yield this.toastController.create({message:e,duration:2e3,position:"bottom"})).present()})}presentLoading(e){return m(this,null,function*(){this.isLoading=!0,yield(yield this.loadingController.create({message:e,spinner:"circles"})).present()})}dismissLoading(){return m(this,null,function*(){this.isLoading=!1,yield this.loadingController.dismiss()})}};l.\u0275fac=function(i){return new(i||l)(h(k),h(z),h(le),h(se),h(me))},l.\u0275cmp=I({type:l,selectors:[["app-login"]],decls:16,vars:4,consts:[["loginForm","ngForm"],["pinForm","ngForm"],["slot","start"],["defaultHref","/"],[1,"ion-padding"],[1,"ion-margin-bottom",3,"ngModelChange","ionChange","ngModel"],["value","caregiver"],["value","patient"],["class","login-form",3,"ngSubmit",4,"ngIf"],[1,"login-form",3,"ngSubmit"],[1,"ion-text-center"],[1,"ion-margin-vertical"],["position","floating"],["type","email","name","email","required","","autocomplete","email",3,"ngModelChange","ngModel"],["type","password","name","password","required","","autocomplete","current-password",3,"ngModelChange","ngModel"],["expand","block","type","submit",3,"disabled"],["name","dots",4,"ngIf"],[4,"ngIf"],[1,"ion-text-center","ion-margin-vertical"],["color","medium"],["routerLink","/register"],["name","dots"],["type","text","name","pin","required","","maxlength","6","pattern","[0-9]*","inputmode","numeric",3,"ngModelChange","ngModel"]],template:function(i,a){i&1&&(t(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",2),v(3,"ion-back-button",3),n(),t(4,"ion-title"),s(5,"Login"),n()()(),t(6,"ion-content",4)(7,"ion-segment",5),x("ngModelChange",function(_){return w(a.loginType,_)||(a.loginType=_),_}),y("ionChange",function(){return a.onLoginTypeChange()}),t(8,"ion-segment-button",6)(9,"ion-label"),s(10,"Cuidador"),n()(),t(11,"ion-segment-button",7)(12,"ion-label"),s(13,"Idoso"),n()()(),C(14,ue,23,8,"form",8)(15,fe,14,5,"form",8),n()),i&2&&(r(3),f("aria-label","Voltar para p\xE1gina inicial"),r(4),b("ngModel",a.loginType),r(7),d("ngIf",a.loginType==="caregiver"),r(),d("ngIf",a.loginType==="patient"))},dependencies:[ge,U,J,K,Q,X,Y,Z,$,ee,ie,te,ne,oe,A,G,ae,re,H,R,V,B,j,D,q,F,W,T,M,N,O,E],styles:["ion-content[_ngcontent-%COMP%]{--background: #FFD700}.login-form[_ngcontent-%COMP%]{max-width:500px;margin:0 auto;padding:20px;background:#fff;border-radius:16px;box-shadow:0 4px 12px #0000001a}.login-form[_ngcontent-%COMP%]   h1[_ngcontent-%COMP%]{font-size:24px;margin-bottom:8px;font-weight:600;color:#000}.login-form[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{color:var(--ion-color-medium);margin-bottom:24px}.login-form[_ngcontent-%COMP%]   ion-item[_ngcontent-%COMP%]{--background: white;--padding-start: 0;--border-color: var(--ion-color-medium);--highlight-height: 1px;margin-bottom:16px;border-radius:8px}.login-form[_ngcontent-%COMP%]   ion-item.item-has-focus[_ngcontent-%COMP%]{--highlight-background: var(--ion-color-primary)}.login-form[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%]{margin-top:24px;--border-radius: 8px}.login-form[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]{text-decoration:none;color:var(--ion-color-primary);font-weight:500}.login-form[_ngcontent-%COMP%]   a[_ngcontent-%COMP%]:hover{text-decoration:underline}"]});let o=l;return o})();export{Te as LoginPage};
